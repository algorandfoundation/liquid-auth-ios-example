# Liquid Auth iOS Example App
Welcome to the Example app and extension showcasing Liquid Auth iOS (LiquidAuthSDK).

For the Liquid Auth iOS SDK, [press here](https://github.com/algorandfoundation/liquid-auth-ios).

For the Liquid Auth official documentation, [press here](liquidauth.com).

# Structure

The example app has a main app, whose entrypoint is `liquid-auth-ios-example/ContentView.swift`. The main app comes with a QR code scanner, which can be used to scan `liquid://` URI QR codes. From there the Liquid Auth SDK is used to handle registering and authenticating against a Liquid Auth backend, followed by the creation of the WebRTC data channel. Once the data channel has been setup, data (such as transaction bytes to be signed) can be communicated over.

The extension, whose entrypoint is `AutofillCredentialExtension/CredentialProviderViewController.swift`, contains code and permissions allowing the app to be listed as a (potential) Passkey Manager under `Settings/General/Autofill & Passwords`. It implements `ASCredentialProviderViewController` and overrides key methods, such as `prepareInterface` and `prepareCredentialList`. As a result, the user can open up the standard iPhone Camera App, scan a `FIDO:/` URI QR code (e.g., at [webauthn.io](https://webauthn.io) for testing) and have the app pop up as an alternative for registering and authenticating with passkeys.

Finally, code that is shared between the two parts, particularly cryptography-related code (mnemonics, key generation, signing, etc) is found in the shared library `ExampleShared`.

> ⚠️ **Warning:** Do NOT use the mnemonic seed phrase hardcoded in this example iOS app!

> ⚠️ **Warning:** In your own implementation, it will be up to you to keep your mnemonics/keypairs stored securely. 


# Flow

## Registration

The first step is to register a passkey. In the process, we also prove ownership of a specific Algorand Address, and (for `liquid://`) a requestId. 

The passkey is denoted by its credentialId, which should be deterministically generated from the public key.

The requestId is a UUID value generated by the Liquid Auth backend. We will use it later.

## Authentication

After you've registered a passkey, you can return and authenticate with that same passkey. Like in the registration step, we also prove ownership of the Algorand Address and include the requestId.

The passkey is denoted by its credentialId, which should be deterministically generated from the public key.

## WebRTC Communication

The same requestId that was included in the WebAuthn flow. That is used to setup the WebRTC data channel.

# How to test?

Note that WebRTC does not work in Simulator, only on an actual device.

## liquid:// URIs

To test out the `liquid://` URI QR codes, you can navigate to [liquidauth.com](liquidauth.com) and scroll down to the QR code there.

Alternatively, to test the full connection (authentication + communication) you can clone down TxnLab's [use-wallet](https://github.com/TxnLab/use-wallet). The example frontends have `Liquid` as a provider. Connect with it - it uses the Algorand Foundation hosted at `debug.liquidauth.com`- and press `Send Transaction`.

Your browser "dApp" will send transaction bytes over the WebRTC Data Channel. This example app will interpret those ARC27 encoded bytes and prompt you to ask if you want to sign them. To do so, you need to either pass the biometrics/pincode prompt. Once done, the bytes will be signed and returned to your browser.

(Note that any kind of message can be sent back and forth over WebRTC with Liquid Auth, but in this app the focus is on transaction bytes.)


## FIDO:/ URIs

To test out the `FIDO:/` URI QR codes, you must make this app an approved app under `Settings/General/Autofill & Passkeys`. Then navigate to a website like [webauthn.io](webauthn.io), [webauthn.me](webauthn.me) or [passkeys.com](passkeys.com). Go through the Registration flow to be presented with a FIDO QR code. Scan it with the default iPhone Camera App, **NOT** the main Liquid Auth Example app. You will see a `Save a passkey` prompt. Press it, pass the Biometrics/Pincode prompt.

Repeat the same for Authentication.